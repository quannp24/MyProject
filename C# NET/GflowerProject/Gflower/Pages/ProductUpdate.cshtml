@page
@model Gflower.Pages.ProductUpdateModel
@{
}
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Tell the browser to be responsive to screen width -->
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>SpanLuxy-Product</title>
    <link rel="shortcut icon" href="~/Image/Resource/icon.ico" type="image/x-icon">
    <!-- Favicon icon -->
    <!-- Bootstrap Core CSS -->
    <link href="~/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/css/perfect-scrollbar.css" rel="stylesheet">
    <!-- This page CSS -->
    <!-- chartist CSS -->
    <link href="~/css/morris.css" rel="stylesheet">
    <!--c3 CSS -->
    <link href="~/css/c3.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="~/css/styleManagement.css" rel="stylesheet">
    <!-- Dashboard 1 Page CSS -->
    <link href="~/css/dashboard1.css" rel="stylesheet">


</head>
<body class="fix-header fix-sidebar card-no-border">
    <!-- ============================================================== -->
    <!-- Preloader - style you can find in spinners.css -->
    <!-- ============================================================== -->

    <div id="main-wrapper">
        <!-- ============================================================== -->
        <!-- Topbar header - style you can find in pages.scss -->
        <!-- ============================================================== -->
        <header class="topbar" style="margin-bottom:20px;background-color:#d2c9c9">
            <nav class="navbar top-navbar navbar-expand-md navbar-light">
                <!-- ============================================================== -->
                <!-- Logo -->
                <!-- ============================================================== -->
                <div class="navbar-header" style="text-align:center">
                    <a class="navbar-brand" href="~/home" style="width: 32%;">
                        <img class="img-title" src="~/Image/Resource/ne.png" width="70px" height="auto">
                        <span>
                            SpanLuxy
                        </span>
                    </a>
                </div>
                <!-- ============================================================== -->
                <!-- End Logo -->
                <!-- ============================================================== -->
                <div class="navbar-collapse" style="background:#d2c9c9">
                    <!-- ============================================================== -->
                    <!-- toggle and nav items -->
                    <!-- ============================================================== -->
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link nav-toggler hidden-md-up waves-effect waves-dark"
                               href="javascript:void(0)"><i class="fa fa-bars"></i></a>
                        </li>
                        <!-- ============================================================== -->
                        <!-- Search -->
                        <!-- ============================================================== -->
                        <li class="nav-item hidden-xs-down search-box">
                            <a class="nav-link hidden-sm-down waves-effect waves-dark" href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                            <form class="app-search">
                                <input type="text" class="form-control" placeholder="Search & enter"> <a class="srh-btn"><i class="fa fa-times"></i></a>
                            </form>
                        </li>
                    </ul>
                    <!-- ============================================================== -->
                    <!-- User profile and search -->
                    <!-- ============================================================== -->
                    <ul class="navbar-nav my-lg-0">
                        <!-- ============================================================== -->
                        <!-- Profile -->
                        <!-- ============================================================== -->
                        <li class="nav-item dropdown u-pro">
                            <a class="nav-link dropdown-toggle waves-effect waves-dark profile-pic" href="#" id="navbarDropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img src="~/Image/Resource/iconavatar.png" alt="user" class="" /> <span class="hidden-md-down">Hello @Model.account.FirstName</span>
                            </a>
                            <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                                <a class="dropdown-item" href="#">Profile</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Settings</a>
                                <a class="dropdown-item" href="#">Change Password</a>
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="#">Logout</a>

                            </div>
                        </li>

                    </ul>
                </div>
            </nav>
        </header>
        <!-- ============================================================== -->
        <!-- End Topbar header -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Left Sidebar - style you can find in sidebar.scss  -->
        <!-- ============================================================== -->
        <aside class="left-sidebar">
            <!-- Sidebar scroll-->
            <div class="scroll-sidebar">
                <!-- Sidebar navigation-->
                <nav class="sidebar-nav">
                    <ul id="sidebarnav">
                        <li>
                            <a class="waves-effect waves-dark" href="/Management" aria-expanded="false">
                                <i class="fa fa-tachometer"></i><span class="hide-menu">Orders</span>
                            </a>
                        </li>
                        <li>
                            <a class="waves-effect waves-dark" href="/product" aria-expanded="false">
                                <i class="fa fa-user-circle-o"></i><span class="hide-menu">Product</span>
                            </a>
                        </li>

                </nav>
                <!-- End Sidebar navigation -->
            </div>
            <!-- End Sidebar scroll-->
        </aside>
        <!-- ============================================================== -->
        <!-- End Left Sidebar - style you can find in sidebar.scss  -->
        <!-- ============================================================== -->
        <!-- ============================================================== -->
        <!-- Page wrapper  -->
        <!-- ============================================================== -->
        <div class="page-wrapper" id="content-bodyload" style="display:none">
            <!-- ============================================================== -->
            <!-- Container fluid  -->
            <!-- ============================================================== -->
            <div class="container-fluid">
                <!-- ============================================================== -->
                <!-- Bread crumb and right sidebar toggle -->
                <!-- ============================================================== -->
                <div class="row page-titles" style="margin-top:40px">
                    <div class="col-md-9 align-self-center">
                        <h3 class="text-themecolor">Dashboard Products</h3>
                        <ol class="breadcrumb">
                            <li class="breadcrumb-item"><a href="/home">Home</a></li>
                            <li class="breadcrumb-item "><a href="/product">Product</a></li>
                            <li class="breadcrumb-item active">Update product</li>
                     
                        </ol>
                    </div>
            
                </div>



                <div class="row">
                    <!-- Start Notification -->
                    <div class="col-lg-12 col-md-12">
                        <div class="card card-body mailbox">
                            
                            <div class="container" id="addNew" >
                                <div class="row">
                                    <div class="col-md-9">
                                        <h2>Update Product</h2>
                                    </div>
                                    <div class="col-md-3">
                                        <a class="delete-button" data-product-id=@Model.product.ProductId style="float:right">Remove</a>
                                    </div>
                                </div>
                        
                                @if (TempData["SuccessMessage"] != null)
                                {
                                    <h4 style="color:green">Update success.</h4>
                                }
                                @if (TempData["ErrorMessage"] != null)
                                {
                                    <h6 style="color:red">@TempData["ErrorMessage"]</h6>
                                }
                                <form method="post" enctype="multipart/form-data"  asp-page-handler="UpdateProduct" asp-page="/ProductUpdate" style="color:#9a9795">
                                    <div class="form-group">
                                        <label for="productName">Product Name:</label>
                                        <input asp-for="Input.Name" class="form-control" id="productName" value="@Model.product.ProductName">
                                    </div>
                                    <div class="form-group">
                                        <label for="productPrice">Product Price:</label>
                                        <input asp-for="Input.Price" class="form-control" id="productPrice" value="@Model.product.ProductPrice">
                                    </div>
                                    <div class="form-group">
                                        <label for="productDescription">Description:</label>
                                        <input asp-for="Input.Description" class="form-control" id="productPrice" value="@Model.product.ProductDescription">
                                    </div>
                                    <div class="form-group">
                                        <label for="productDiscount">Discount:</label>
                                        <input type="number" class="form-control" asp-for="Input.Discount" id="productDiscount" value="@Model.product.Discount">
                                        <input type="number" hidden class="form-control" id="productId" asp-for="productId" value="@Model.product.ProductId">
                                    </div>
                                    <div class="form-group">
                                        <label for="productDiscount">Status:</label>
                                        <select class="form-control" asp-for="Input.Status" style="width:200px">
                                            @if (Model.product.Status == 1)
                                            {
                                                <option value="1" selected>Show</option>
                                                <option value="0">Hide</option>
                                            }
                                            else if (Model.product.Status == 0)
                                            {
                                                <option value="1">Show</option>
                                                <option value="0" selected>Hide</option>
                                            }
                                        </select>
                                    </div>

                                    <div class="form-group">
                                        <label for="productImage">Image:</label>
                                        <input type="file" class="form-control-file" asp-for="Input.FileUploads" id="productImage">
                                        <div id="image-preview">
                                            <img id="current-image" src="~/Image/bouquet/@Model.product.ProductImage" alt="currently image">
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">Submit</button>
                                </form>
                            </div>
                        </div>
                    </div>
                    <!-- End Notification -->
                    <!-- Start Feeds -->
                    <!-- End Feeds -->
                </div>

            </div>

            <footer class="footer"> © 2023 SpanLuxy</a> </footer>

        </div>
    </div>



</body>
<div id="loading-screen">
    <img src="~/Image/Resource/ne.png" alt="Logo" class="logo-load">
</div>
<div id="delete-modal" class="modal-remove">
    <div class="modal-content">
        <p style="text-align:center">Do you want to delete this product?</p>
        <img src="~/Image/Resource/imgRemove.gif" width="150px"/>
        <p style="color:red" id="messRemove"></p>
        <div class="row">
            <div class="col-md-6">
                <button class="btn btn-sm btn-danger"  id="confirm-delete">Remove</button>
            </div>
            <div class="col-md-6">
                <button class="btn btn-sm btn-dark" id="cancel-delete">Cancel</button>
            </div>
        </div>

    </div>
</div>
<style>
    #image-preview {
        width: 300px;
        height: 200px;
        border: 1px solid #ccc;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    #current-image {
        max-width: 100%;
        max-height: 100%;
    }


    /* CSS cho modal */
    .modal-remove {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 20;
        background-color: rgba(0, 0, 0, 0.5); /* Màu nền mờ */
    }

    .modal-content {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background-color: #fff;
        padding: 20px;
        border-radius: 5px;
        width:24%;
    }

    .modal-content p{
        font-weight:bold;
        font-size:16px;
    }

    .modal-content img{
        margin: auto;
        margin-bottom:10px;
    }

    #confirm-delete{
        width:100px;
        margin-left:24%;
    }

    #cancel-delete{
        width: 100px;
        margin-left:24%;
    }

    /* CSS cho nút xóa sản phẩm */
    .delete-button {
        color: #f02626;
        font-size:15px;
        font-weight:bold;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

</style>
<script src="~/js/jquery.min.js"></script>
<script src="~/js/bootstrap.bundle.min.js"></script>
<script src="~/js/perfect-scrollbar.jquery.min.js"></script>
<!--Wave Effects -->
<script src="~/js/waves.js"></script>
<!--Menu sidebar -->
<script src="~/js/sidebarmenu.js"></script>
<!--Custom JavaScript -->
<script src="~/js/custom.min.js"></script>
<script src="~/js/dashboard1.js"></script>

<script>
        window.addEventListener("load", function () {
        setTimeout(function () {
            document.getElementById("content-bodyload").style.display = "block";
        }, 1000);
        setTimeout(function () {
            document.getElementById("loading-screen").style.display = "none";
        }, 1100);
    });
    document.getElementById("productImage").addEventListener("change", function (event) {
        const fileInput = event.target;

        if (fileInput.files && fileInput.files[0]) {
            const reader = new FileReader();

            reader.onload = function (e) {
                const previewImage = document.getElementById("previewImage");
                const image = document.createElement("img");
                image.src = e.target.result;
                image.style.maxWidth = "200px"; // Tùy chỉnh kích thước ảnh hiển thị (tùy chọn)
                image.style.maxHeight = "200px"; // Tùy chỉnh kích thước ảnh hiển thị (tùy chọn)
                previewImage.innerHTML = ""; // Xóa hình ảnh hiển thị cũ
                previewImage.appendChild(image);
            };

            reader.readAsDataURL(fileInput.files[0]);
        }
    });

    var imageInput = document.getElementById("productImage");
    var currentImage = document.getElementById("current-image");

    imageInput.addEventListener("change", function () {
        var file = imageInput.files[0];
        var reader = new FileReader();

        reader.onload = function (event) {
            currentImage.src = event.target.result;
        };

        if (file) {
            reader.readAsDataURL(file);
        }
    });



    var deleteModal = document.getElementById("delete-modal");
    var confirmDeleteButton = document.getElementById("confirm-delete");
    var cancelDeleteButton = document.getElementById("cancel-delete");
    var deleteButtons = document.getElementsByClassName("delete-button");

    // Hiển thị modal xác nhận xóa sản phẩm
    function showDeleteModal(productId) {
        deleteModal.style.display = "block";

        confirmDeleteButton.onclick = function () {
            deleteProduct(productId);
            hideDeleteModal();
        };

        cancelDeleteButton.onclick = function () {
            hideDeleteModal();
        };
    }

    // Ẩn modal xác nhận xóa sản phẩm
    function hideDeleteModal() {
        deleteModal.style.display = "none";
    }

    // Gọi Ajax để xóa sản phẩm
    function deleteProduct(productId) {
        var apiUrl = "api/products/" + productId; // Thay thế bằng URL API xóa sản phẩm

        // Gọi Ajax để xóa sản phẩm
        $.ajax({
            type: 'GET',
            url: '/ProductUpdate?handler=RemoveProduct',
            data: { productId: productId },
            success: function (data) {
                if (data.status == false) {
                    $("#messRemove$").text("Remove product fail something, try again!");
                }else{
                    window.location.href = "/Product";
                }
            }
        });
    }

    // Lắng nghe sự kiện click trên nút xóa sản phẩm
    for (var i = 0; i < deleteButtons.length; i++) {
        deleteButtons[i].addEventListener("click", function (event) {
            var productId = event.target.getAttribute("data-product-id");
            showDeleteModal(productId);
        });
    }
   
</script>
</html>